System.register("bundle://main/_virtual/AssetLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,o,t,s,a,i,n,c,p,l,u;return{setters:[function(r){e=r.applyDecoratedDescriptor,o=r.inheritsLoose,t=r.initializerDefineProperty,s=r.assertThisInitialized},function(r){a=r.cclegacy,i=r._decorator,n=r.ProgressBar,c=r.director,p=r.resources,l=r.SpriteFrame,u=r.Component}],execute:function(){var d,f,g,h,m;a._RF.push({},"ff792SUt8BAQoHTgLc+DQEW","AssetLoader",void 0);var B=i.ccclass,y=i.property;r("AssetLoader",(d=B("AssetLoader"),f=y(n),d((m=e((h=function(r){function e(){for(var e,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=r.call.apply(r,[this].concat(a))||this,t(e,"progressBar",m,s(e)),e}o(e,r);var a=e.prototype;return a.__preload=function(){if(!this.progressBar)throw new Error("ProgressBar is required");c.preloadScene("GameScene-refactor"),p.preloadDir("images"),p.preloadDir("sfx")},a.start=function(){var r=this;p.loadDir("images",l,(function(e,o){r.updateProgressBar(e/o)}),(function(e){e?console.error(e):(r.updateProgressBar(1),r.switchToGameScene())}))},a.updateProgressBar=function(r){this.progressBar.progress=r},a.switchToGameScene=function(){c.loadScene("GameScene-refactor")},e}(u)).prototype,"progressBar",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=h))||g));a._RF.pop()}}}));

System.register("bundle://main/_virtual/Board.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var o,e,t,n;return{setters:[function(r){o=r.inheritsLoose},function(r){e=r.cclegacy,t=r._decorator,n=r.Component}],execute:function(){var a;e._RF.push({},"8ae05lf1rpKDpv8f2Doayfz","Board",void 0);var c=t.ccclass;t.property,r("Board",c("Board")(a=function(r){function e(){return r.apply(this,arguments)||this}return o(e,r),e}(n))||a);e._RF.pop()}}}));

System.register("bundle://main/_virtual/BoardState.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,o;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,o=t.Component}],execute:function(){n._RF.push({},"1f4635zkYxPNpzJjbAMP0BT","BoardState",void 0);t("default",function(t){function n(e){var n;return(n=t.call(this)||this).board=void 0,n.board=e,n}return e(n,t),n}(o));n._RF.pop()}}}));

System.register("bundle://main/_virtual/ColumnSubTile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./SubTile.ts"],(function(o){var n,i,t,e,d,s,r;return{setters:[function(o){n=o.inheritsLoose},function(o){i=o.cclegacy,t=o._decorator,e=o.Vec3,d=o.tween},function(o){s=o.default},function(o){r=o.SubTile}],execute:function(){var a;i._RF.push({},"1f0ad49O/NEloBDL+DmlQnk","ColumnSubTile",void 0);var u=t.ccclass;t.property,o("ColumnSubTile",u("ColumnSubTile")(a=function(o){function i(){return o.apply(this,arguments)||this}n(i,o);var t=i.prototype;return t.getRelative=function(o){for(var n=this,i=[],t=0;t<s.GridHeight;t++)i.push(o.board[t][this.diamond.getCoordinate().x]);return i.filter((function(o){return!o.pending})).filter((function(o){return o!=n.diamond}))},t.launch=function(o){var n=this;if(!this.diamond.node.active)return[];var i=this.diamond.rowFX[0],t=this.diamond.rowFX[1];console.log(t),i.node.active=!0,t.node.active=!0,i.node.setPosition(this.diamond.node.position),t.node.setPosition(this.diamond.node.position),i.node.setRotationFromEuler(0,0,270),t.node.setRotationFromEuler(0,0,90);var s=new e(this.diamond.node.position.x,this.diamond.node.position.y+1e3),r=new e(this.diamond.node.position.x,this.diamond.node.position.y-1e3);return console.log(r),d(i.node).to(.35,{position:new e(s.x,s.y)}).call((function(){i.node.active=!1,i.node.setPosition(n.diamond.node.position)})).start(),d(t.node).to(.35,{position:new e(r.x,r.y)}).call((function(){console.log("done"),t.node.active=!1,t.node.setPosition(n.diamond.node.position)})).start(),[]},i}(r))||a);i._RF.pop()}}}));

System.register("bundle://main/_virtual/Diamond.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./Match3Board.ts","./ColumnSubTile.ts","./Explosion.ts","./RainBowSubTile.ts","./RowSubTile.ts"],(function(t){var i,e,n,o,r,l,s,a,u,c,h,p,f,d,w,b,g,v,T,m,y,C,S;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,s=t.ParticleSystem2D,a=t.Sprite,u=t.Prefab,c=t.AudioSource,h=t.Color,p=t.tween,f=t.Vec3,d=t.resources,w=t.SpriteFrame,b=t.instantiate,g=t.Component},function(t){v=t.default},function(t){T=t.default},function(t){m=t.ColumnSubTile},function(t){y=t.ExplosionSubTile},function(t){C=t.RainBowSubTile},function(t){S=t.RowSubTile}],execute:function(){var k,F,O,x,P,R,z,D,X,A,H,E,M;r._RF.push({},"bb62fa1dCZOkppu4UmwA8UM","Diamond",void 0);var V=l.ccclass,B=l.property;t("default",(k=V("Diamond"),F=B(s),O=B(a),x=B(a),P=B(u),R=B(c),k((X=i((D=function(t){e(r,t);var i=r.prototype;function r(){var i;return(i=t.call(this)||this).rowFX=[],n(i,"particle",X,o(i)),n(i,"sprite",A,o(i)),n(i,"light",H,o(i)),n(i,"rowFXPrefab",E,o(i)),n(i,"sfx",M,o(i)),i.coordinate={x:0,y:0},i.lastcoordinate={x:0,y:0},i.type="type1",i.effect="tile",i.onClickCallbacks=[],i.staple=!1,i.onKillCallbacks=[],i.flipTween=null,i.hintTween=null,i.lightHintTween=null,i.pending=!1,i.subTiles={row:new S(o(i)),column:new m(o(i)),explosion:new y(o(i)),rainbow:new C(o(i))},i.currentSubTile=null,i}return i.getCoordinate=function(){return{x:this.coordinate.x,y:this.coordinate.y}},i.getSprite=function(){return this.sprite},i.update=function(t){},i.setCoordinate=function(t,i){this.coordinate.x=t,this.coordinate.y=i},i.addOnKillCallback=function(t){this.onKillCallbacks.push(t)},i.emitOnKill=function(t){return this.currentSubTile.launch(t)},i.getType=function(){return this.type},i.setType=function(t){this.type=t,this.sprite&&(this.sprite.color=v.CandyColor[t]),this.lightOff()},i.lightOn=function(){var t,i,e;this.light.color=new h(null==(t=this.sprite)?void 0:t.color.r,null==(i=this.sprite)?void 0:i.color.g,null==(e=this.sprite)?void 0:e.color.b,50)},i.chose=function(){var t;this.flipTween?this.flipTween.start():this.flipTween=p(null==(t=this.sprite)?void 0:t.node).to(.2,{scale:new f(1.25,1.25)}).repeatForever(p().to(.25,{eulerAngles:new f(0,0,20)}).to(.5,{eulerAngles:new f(0,0,-20)}).to(.25,{eulerAngles:new f(0,0,0)})).start()},i.hint=function(){if(this.sprite&&this.sprite.isValid&&this.light&&this.light.isValid){var t=this.sprite.color.clone();this.hintTween?this.hintTween.start():this.hintTween=p(this.sprite).repeatForever(p().to(.2,{color:new h(t.r,t.g,t.b,100)}).to(.2,{color:new h(t.r,t.g,t.b,255)})).start(),this.lightHintTween?this.lightHintTween.start():this.lightHintTween=p(this.light).repeatForever(p().to(.2,{color:new h(t.r,t.g,t.b,50)}).to(.2,{color:new h(t.r,t.g,t.b,20)})).start()}},i.unhint=function(){var t,i;if(this.sprite&&this.sprite.isValid&&this.light&&this.light.isValid){var e=this.sprite.color.clone();null==(t=this.lightHintTween)||t.stop(),null==(i=this.hintTween)||i.stop(),this.lightOff(),this.sprite.color=new h(e.r,e.g,e.b,255)}},i.release=function(){var t,i;null==(t=this.flipTween)||t.stop(),p(null==(i=this.sprite)?void 0:i.node).to(.2,{scale:new f(1,1,1)}).to(.1,{eulerAngles:new f(0,0,0)},{easing:"bounceOut"}).start()},i.lightOff=function(){var t,i,e;this.light.color=new h(null==(t=this.sprite)?void 0:t.color.r,null==(i=this.sprite)?void 0:i.color.g,null==(e=this.sprite)?void 0:e.color.b,20)},i.getEffect=function(){return this.effect},i.randomType=function(){var t=v.CandyTypes[Math.floor(Math.random()*v.CandyTypes.length)];this.node.setScale(new f(1,1,1)),this.setType(t),this.node.active=!0},i.addOnclickCallbacks=function(t){this.onClickCallbacks.push(t)},i.emitOnClick=function(){var t=this;this.onClickCallbacks.forEach((function(i){i(t)}))},i.removeOnClickCallbacks=function(){this.onClickCallbacks=[]},i.rest=function(){this.node.active=!1},i.setEffect=function(t){this.effect=t;var i=d.get("images/"+t+"/spriteFrame",w);this.sprite.spriteFrame=i,this.currentSubTile="tile"!=t?this.subTiles[t]:null},i.createFX=function(t){for(var i=0;i<2;i++){var e=b(this.rowFXPrefab),n=null==e?void 0:e.getComponent(a);e&&t.node.addChild(e),n&&this.rowFX.push(n)}console.log(this.rowFX)},i.doShrink=function(t,i,e){var n,o,r,l,s=this;return void 0===i&&(i=.4),this.particle.startColor=this.light.color=new h(null==(n=this.sprite)?void 0:n.color.r,null==(o=this.sprite)?void 0:o.color.g,null==(r=this.sprite)?void 0:r.color.b,50),this.pending=!0,null==(l=this.particle)||l.resetSystem(),new Promise((function(e){p(s.sprite.node).to(i,{scale:new f(t,t)},{easing:"sineIn"}).call((function(){T.increase(),e()})).start()}))},i.getRelative=function(t){return this.currentSubTile.getRelative(t)},i.move=function(t,i,e,n){var o=this;return void 0===e&&(e=.7),void 0===n&&(n="bounceOut"),new Promise((function(r){p(o.node).to(e,{position:new f(t,i)},{easing:n}).call((function(){return r()})).start()}))},r}(g)).prototype,"particle",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=i(D.prototype,"sprite",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=i(D.prototype,"light",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=i(D.prototype,"rowFXPrefab",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=i(D.prototype,"sfx",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=D))||z));r._RF.pop()}}}));

System.register("bundle://main/_virtual/DiamondTile.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,o,i;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,o=n._decorator,i=n.Component}],execute:function(){var r;e._RF.push({},"357f7Z+wzRP970IVp0fpm6J","DiamondTile",void 0);var c=o.ccclass;o.property,n("DiamondTile",c("DiamondTile")(r=function(n){function e(){return n.apply(this,arguments)||this}t(e,n);var o=e.prototype;return o.start=function(){},o.update=function(n){},e}(i))||r);e._RF.pop()}}}));

System.register("bundle://main/_virtual/Explosion.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./SubTile.ts"],(function(o){var t,n,i,e,r,a;return{setters:[function(o){t=o.inheritsLoose},function(o){n=o.cclegacy,i=o._decorator,e=o.tween},function(o){r=o.default},function(o){a=o.SubTile}],execute:function(){var s;n._RF.push({},"987f3J0X6lIp6fhXlay/Xuf","Explosion",void 0);var u=i.ccclass;i.property,o("ExplosionSubTile",u("ExplosionSubTile")(s=function(o){function n(){return o.apply(this,arguments)||this}t(n,o);var i=n.prototype;return i.getRelative=function(o){for(var t=[],n=0,i=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];n<i.length;n++){var e=i[n];this.diamond.getCoordinate().x+e[0]<r.GridWidth&&this.diamond.getCoordinate().x+e[0]>=0&&this.diamond.getCoordinate().y+e[1]<r.GridHeight&&this.diamond.getCoordinate().y+e[1]>=0&&t.push(o.board[this.diamond.getCoordinate().y+e[1]][this.diamond.getCoordinate().x+e[0]])}return t.filter((function(o){return!o.pending}))},i.launch=function(o){console.log("launch expl");var t=[],n=this.diamond.node.position;console.log(n);for(var i=this.getRelative(o),a=new Set(i.concat(this.diamond)),s=0;s<r.GridHeight;s++)for(var u=function(){var i=o.board[s][d];if(!i||a.has(i))return 1;var r=i.node.position.clone(),u=r.clone().subtract(n).normalize().multiplyScalar(30);t.push(new Promise((function(o){e(i.node).to(.1,{position:r.add(u)}).to(.05,{position:r},{easing:"bounceOut"}).call((function(){return o()})).start()})))},d=0;d<r.GridWidth;d++)u();return t},n}(a))||s);n._RF.pop()}}}));

System.register("bundle://main/_virtual/FallState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Match3Board.ts","./BoardState.ts"],(function(o){var t,e,r,n,a;return{setters:[function(o){t=o.inheritsLoose,e=o.createForOfIteratorHelperLoose},function(o){r=o.cclegacy},function(o){n=o.default},function(o){a=o.default}],execute:function(){r._RF.push({},"0144fWRrGNPY4wGytQr4AMW","FallState",void 0);o("default",function(o){function r(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r))||this).promises=[],t}t(r,o);var a=r.prototype;return a.onEnter=function(){var o=this;this.board.pausing&&this.board.switchState("pause"),this.promises=[],console.log("move down"),this.reShowTile(),this.moveDown(),Promise.all(this.promises).then((function(){o.board.checkAll().length>0?o.board.switchState("kill"):o.board.switchState("idle")}))},a.onExit=function(){},a.onUpdate=function(){},a.reShowTile=function(){for(var o,t=e(this.board.board);!(o=t()).done;)for(var r,n=o.value,a=e(n);!(r=a()).done;){var i=r.value;i.node.active||i.randomType(),i.node.setScale(1,1,1)}},a.moveDown=function(){for(var o,t=e(this.board.board);!(o=t()).done;)for(var r,a=o.value,i=e(a);!(r=i()).done;){var s=r.value,l=n.coordToPos(s.getCoordinate().x,s.getCoordinate().y);this.promises.push(s.move(l.x,l.y))}},r}(a));r._RF.pop()}}}));

System.register("bundle://main/_virtual/GameConfig.ts",["cc"],(function(e){var i,t;return{setters:[function(e){i=e.cclegacy,t=e.Color}],execute:function(){i._RF.push({},"066a2a7XoVHzJHXDKi1vGjH","GameConfig",void 0);e("default",{GridWidth:8,GridHeight:8,TileWidth:72,TileHeight:72,CandyTypes:["tile1","tile2","tile3","tile4","tile7"],CandyColor:{tile1:new t(255,85,85,255),tile2:new t(85,255,85,255),tile3:new t(85,85,255,255),tile4:new t(255,255,255,255),tile5:new t(85,255,255,255),tile6:new t(255,85,255,255),tile7:new t(255,255,0,255),black:new t(0,0,0,255)}});i._RF.pop()}}}));

System.register("bundle://main/_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./TileGrid.ts","./TilePool.ts"],(function(e){var t,i,n,r,o,s,a,c,l,u,h,f,p,d,g,b,v;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){a=e.cclegacy,c=e._decorator,l=e.Prefab,u=e.Sprite,h=e.RichText,f=e.Component,p=e.instantiate,d=e.Vec3},function(e){g=e.default},function(e){b=e.default},function(e){v=e.default}],execute:function(){var T,C,m,w,y,x,P,G,k,z,M,H,S,W,_,R,U,D;a._RF.push({},"46ae41xTnJMzb4YJT35+oz1","GameManager",void 0);var L=c.ccclass,F=c.property;e("default",(T=L("GameManager"),C=F(b),m=F(v),w=F(l),y=F(l),x=F(u),P=F(h),G=F(l),T(((D=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return t=e.call.apply(e,[this].concat(o))||this,n(t,"grid",M,r(t)),n(t,"pool",H,r(t)),t.firstChosen=void 0,t.secondChosen=void 0,n(t,"tilePrefab",S,r(t)),n(t,"brickprefeb",W,r(t)),n(t,"cursor",_,r(t)),n(t,"scoreText",R,r(t)),n(t,"roweff",U,r(t)),t.milestone=500,t.milecheck=!1,t}i(t,e),t.increase=function(){t.Score+=10};var a=t.prototype;return a.__preload=function(){this.grid||console.error("TileGrid is not assigned in GameManager"),this.pool||console.error("TilePool is not assigned in GameManager"),this.tilePrefab||console.error("TilePrefab is not assigned in GameManager")},a.update=function(){var e=o(s().mark((function e(i){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.scoreText.string=String(t.Score);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.start=function(){var e=o(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==(t=this.pool)||t.setupPrefab(this.tilePrefab),e.next=3,this.createTable();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.createTable=function(){var e=o(s().mark((function e(){var t,i,n,r,o,a,c,l,u=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=0;a<g.GridHeight;a++)for(c=0;c<g.GridWidth;c++)l=p(this.brickprefeb),this.node.addChild(l),null==l||l.setPosition(new d(this.getTilePosition(c,a).x,this.getTilePosition(c,a).y));return null==(t=this.pool)||t.initPool(g.GridHeight*g.GridWidth),null==(i=this.pool)||i.getList().forEach((function(e){u.node.addChild(e.node)})),null==(n=this.grid)||n.initTable(),e.next=6,null==(r=this.grid)?void 0:r.fillTable(this.pool);case 6:null==(o=this.grid)||o.setUpManager(this);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.unChose=function(){this.grid.choosingTile=null,this.firstChosen&&this.firstChosen.release(),this.secondChosen&&this.secondChosen.release()},a.tileUp=function(){this.firstChosen=void 0,this.secondChosen=void 0,this.grid.canChoose=!0},a.Chose=function(){var e=o(s().mark((function e(t){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.grid.choosingTile=t,t.coords!==(null==(i=this.firstChosen)?void 0:i.coords)){e.next=5;break}return console.log("Tile already chosen, unchoosing it"),this.unChose(),e.abrupt("return");case 5:if(this.firstChosen){e.next=12;break}this.cursor.node.active=!0,this.cursor.node.setPosition(this.grid.choosingTile.node.position),this.firstChosen=t,t.chose(),e.next=21;break;case 12:if(this.cursor.node.active=!1,!this.secondChosen){e.next=15;break}return e.abrupt("return");case 15:return this.secondChosen=t,t.chose(),this.unChose(),e.next=20,this.Move();case 20:this.tileUp();case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.Move=function(){var e=o(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.firstChosen&&this.secondChosen&&this.grid.canSwap(this.firstChosen,this.secondChosen))){e.next=4;break}return e.next=3,this.grid.swap(this.firstChosen,this.secondChosen);case 3:this.tileUp();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.getTilePosition=function(e,t){return{x:-g.GridWidth*g.TileWidth/2+g.TileWidth/2+e*g.TileWidth,y:-(-g.GridHeight*g.TileHeight/2+g.TileHeight/2+t*g.TileHeight)}},t}(f)).Score=0,M=t((z=D).prototype,"grid",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new b}}),H=t(z.prototype,"pool",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new v}}),S=t(z.prototype,"tilePrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(z.prototype,"brickprefeb",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(z.prototype,"cursor",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(z.prototype,"scoreText",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(z.prototype,"roweff",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=z))||k));a._RF.pop()}}}));

System.register("bundle://main/_virtual/IdleState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./Match3Board.ts","./BoardState.ts"],(function(t){var o,e,n,i,s,r,a,h;return{setters:[function(t){o=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,i=t.tween,s=t.Vec3},function(t){r=t.default},function(t){a=t.default},function(t){h=t.default}],execute:function(){n._RF.push({},"2e779mK6J5HNokYq+LTvCA/","IdleState",void 0);t("default",function(t){function n(){for(var o,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(o=t.call.apply(t,[this].concat(n))||this).firstChosen=null,o.secondChosen=null,o.staple=[!0,!0],o}o(n,t);var h=n.prototype;return h.onEnter=function(){if(this.board.getProgress()>=1)return this.board.launchConfetti(),this.board.turn+=5,console.log("passMileStone"),this.board.mileStone*=2,void this.board.switchState("shuffle");this.board.isGameOver()?this.board.isOver=!0:this.board.checkAll().length>0?this.board.switchState("kill"):(this.scheduleOnce(this.hint,10),this.schedule(this.idleEffect,15),this.unChoose(),this.turnOnInput())},h.onExit=function(){this.unschedule(this.hint),this.unschedule(this.idleEffect),this.unhint(),this.unChoose(),this.turnOffInput()},h.onUpdate=function(){this.board.pausing&&this.board.switchState("pause")},h.idleEffect=function(){for(var t,o=e(this.board.board);!(t=o()).done;)for(var n,r=t.value,a=function(){var t,o=n.value;i(null==(t=o.getSprite())?void 0:t.node).to(Math.abs(.8-(o.getCoordinate().x+o.getCoordinate().y)/20),{eulerAngles:new s(0,0,90)}).call((function(){o.node.eulerAngles=new s})).start()},h=e(r);!(n=h()).done;)a()},h.unhint=function(){for(var t,o=e(this.board.board);!(t=o()).done;)for(var n,i=t.value,s=e(i);!(n=s()).done;){n.value.unhint()}},h.hint=function(t){void 0===t&&(t=!0);for(var o=0;o<r.GridHeight;o++)for(var n=0;n<r.GridWidth;n++)for(var i,s=this.board.board[o][n],a=this.getAdjacentDiamonds(n,o),h=e(a);!(i=h()).done;){var d=i.value;this.swapDiamonds(s,d);var u=this.board.checkAll();if(this.swapDiamonds(s,d),u.length>0&&t)return s.hint(),void d.hint()}},h.getAdjacentDiamonds=function(t,o){var e=[];return t>0&&e.push(this.board.board[o][t-1]),t<r.GridWidth-1&&e.push(this.board.board[o][t+1]),o>0&&e.push(this.board.board[o-1][t]),o<r.GridHeight-1&&e.push(this.board.board[o+1][t]),e},h.swapDiamonds=function(t,o){var e=t.getCoordinate(),n=o.getCoordinate();t.setCoordinate(n.x,n.y),o.setCoordinate(e.x,e.y),this.board.board[e.y][e.x]=o,this.board.board[n.y][n.x]=t},h.turnOnInput=function(){for(var t,o=this,n=e(this.board.board);!(t=n()).done;)for(var i,s=t.value,r=e(s);!(i=r()).done;){i.value.addOnclickCallbacks((function(t){o.choose(t)}))}},h.turnOffInput=function(){for(var t,o=e(this.board.board);!(t=o()).done;)for(var n,i=t.value,s=e(i);!(n=s()).done;){n.value.removeOnClickCallbacks()}},h.isNextTo=function(t,o){var e=Math.abs(t.getCoordinate().x-o.getCoordinate().x),n=Math.abs(t.getCoordinate().y-o.getCoordinate().y);return 0==e&&1==n||1==e&&0==n},h.choose=function(t){if(this.unschedule(this.idleEffect),this.schedule(this.idleEffect,15),console.log(t.getCoordinate()),null==this.firstChosen)this.firstChosen=t,this.showCursor();else{if(t.getCoordinate()==this.firstChosen.getCoordinate())return this.unChoose(),void console.log("click same, unchoose");this.secondChosen=t,this.isNextTo(this.firstChosen,this.secondChosen)?(console.log("yeah, you make it near"),this.startSwap(this.firstChosen,this.secondChosen)):(this.unChoose(),this.firstChosen=t,this.showCursor())}},h.isStaple=function(){return this.staple[1]&&this.staple[0]},h.showCursor=function(){var t,o;this.board.cursor.node.active=!0,this.board.cursor.node.setPosition(this.firstChosen.node.position),i(this.board.cursor.node).repeatForever(i().to(.5,{scale:new s(1.2,1.2)}).to(.5,{scale:new s(1,1)})).start(),null==(t=this.firstChosen)||t.lightOn(),null==(o=this.firstChosen)||o.chose()},h.startSwap=function(t,o,e){var n,r=this;void 0===e&&(e=!1);var h=[];null==(n=this.firstChosen)||n.release(),this.staple=[!1,!1],this.turnOffInput();var d=a.coordToPos(t.getCoordinate().x,t.getCoordinate().y),u=a.coordToPos(o.getCoordinate().x,o.getCoordinate().y),l=t.getCoordinate();t.setCoordinate(o.getCoordinate().x,o.getCoordinate().y),o.setCoordinate(l.x,l.y),this.board.board[t.getCoordinate().y][t.getCoordinate().x]=t,this.board.board[l.y][l.x]=o,h.push(new Promise((function(t){i(o.node).to(.2,{position:new s(d.x,d.y)}).call((function(){t()})).start()}))),h.push(new Promise((function(o){i(t.node).to(.2,{position:new s(u.x,u.y)}).call((function(){o()})).start()}))),e?Promise.all(h).then((function(){r.board.switchState("idle")})):Promise.all(h).then((function(){r.board.checkAll().length>0?(r.board.switchState("kill",!0,[t,o]),r.board.turn-=1):r.startSwap(t,o,!0)}))},h.unChoose=function(){var t,o;null==(t=this.firstChosen)||t.lightOff(),null==(o=this.firstChosen)||o.release(),this.firstChosen=null,this.secondChosen=null,this.board.cursor.node.active=!1},n}(h));n._RF.pop()}}}));

System.register("bundle://main/_virtual/KillState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Match3Board.ts","./BoardState.ts"],(function(t){var e,i,o,n,a,r;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){o=t.cclegacy,n=t.tween},function(t){a=t.default},function(t){r=t.default}],execute:function(){o._RF.push({},"65dceT3GbZOIJfQg20I+czw","KillState",void 0);t("default",function(t){function o(){for(var e,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).isFirstKill=!1,e.swappedDia=[],e.promises=[],e}e(o,t);var r=o.prototype;return r.onEnter=function(t,e){var i=this;void 0===t&&(t=!1),void 0===e&&(e=[]),this.board.pausing&&this.board.switchState("pause"),console.log("kill"),this.promises=[],t?(this.startKillTurn(e[0],e[1]),this.firstKill()):this.killAllSame(),Promise.all(this.promises).then((function(){i.pushAll(),i.pendDone(),i.board.switchState("fall")}))},r.onExit=function(){this.isFirstKill=!1,this.swappedDia=[]},r.onUpdate=function(){},r.startKillTurn=function(t,e){this.swappedDia.push(t),this.swappedDia.push(e)},r.firstKill=function(){this.killMultipleGrid(this.board.getMatch(this.swappedDia[0])),this.killMultipleGrid(this.board.getMatch(this.swappedDia[1]))},r.killMultipleGrid=function(t,e){var o;void 0===e&&(e=!0),a.SoundOn&&(null==(o=this.board.diaSFX)||o.play()),t=t.filter((function(t){return!t.pending}));for(var n,r=i(t);!(n=r()).done;){var l=n.value;this.handleSpecial(l)}e&&this.makeEffect(t),t=t.filter((function(t){return!t.pending}));for(var s,d=i(t);!(s=d()).done;){var f=s.value;if("tile"==f.getEffect()){var c=f.doShrink(0,.4,this.board);this.promises.push(c)}}},r.pendDone=function(){for(var t,e=i(this.board.board);!(t=e()).done;)for(var o,n=t.value,a=i(n);!(o=a()).done;){var r,l=o.value;if(l.pending)l.node.active=!1,l.pending=!1,null==(r=l.getSprite())||r.node.setScale(1,1,1)}},r.combine=function(t){for(var e,o=this,a=this.board.getMatch(t),r=function(){var i=e.value;o.promises.push(new Promise((function(e){n(i.getSprite().node).to(.2,{position:t.node.position}).call((function(){return e()})).start()})))},l=i(a);!(e=l()).done;)r()},r.handleSpecial=function(t){if("tile"!=t.getEffect()){var e;(e=this.promises).push.apply(e,t.emitOnKill(this.board)),t.doShrink(0,.4,this.board);var i=t.getRelative(this.board);this.killMultipleGrid(i,!1)}t.setEffect("tile")},r.addRowEffect=function(t){this.combine(t),t.setEffect("row"),t.pending=!1},r.addColumnEffect=function(t){this.combine(t),t.setEffect("column"),t.pending=!1},r.addExplosionEffect=function(t){this.combine(t),t.setEffect("explosion"),t.pending=!1},r.addRainbowEffect=function(t){this.combine(t),t.setEffect("rainbow"),t.pending=!1},r.makeEffect=function(t){4==t.length&&(4==this.board.getVerticleMatch(t[0]).length?this.addRowEffect(t[0]):this.addColumnEffect(t[0])),t.length>=5&&(0==this.board.getVerticleMatch(t[0]).length||0==this.board.getHorizontalMatch(t[0]).length?this.addRainbowEffect(t[0]):this.addExplosionEffect(t[0]))},r.killAllSame=function(){console.log("kill");for(var t,e=new Set,o=i(this.board.board);!(t=o()).done;)for(var n,r=t.value,l=i(r);!(n=l()).done;){var s=n.value;if(s.node.active){var d=s.getCoordinate(),f=a.coordToPos(d.x,d.y),c=f.x+","+f.y;if(!e.has(c)){var h=this.board.getMatch(s);if(!(h.length<3)){for(var u,p=s,v=h.length,g=i(h);!(u=g()).done;){var b=u.value,m=this.board.getMatch(b);m.length>v&&(v=m.length,p=b)}for(var E,w=this.board.getMatch(p),y=[],S=i(w);!(E=S()).done;){var M=E.value.getCoordinate(),k=a.coordToPos(M.x,M.y),x=k.x+","+k.y;y.push(x)}for(var C=!1,K=0,D=y;K<D.length;K++){var P=D[K];if(!e.has(P)){C=!0;break}}var R=w.filter((function(t){return t.getCoordinate().y==t.lastcoordinate.y})),F=w.filter((function(t){return t.getCoordinate().y!=t.lastcoordinate.y})),G=[];if(G.push.apply(G,F.concat(R)),console.log(G),C){for(var T,A=i(y);!(T=A()).done;){var O=T.value;e.add(O)}this.killMultipleGrid(G)}}}}}},r.pushAll=function(){for(var t,e=i(this.board.board);!(t=e()).done;)for(var o,n=t.value,r=i(n);!(o=r()).done;){var l=o.value;l.lastcoordinate={x:l.getCoordinate().x,y:l.getCoordinate().y}}for(var s=this.board.board.length,d=this.board.board[0].length,f=0;f<d;f++){for(var c=[],h=[],u=0;u<s;u++){var p=this.board.board[u][f];p.pending?(h.push(p),p.node.setPosition(a.coordToPos(p.getCoordinate().x,0).x,700)):c.push(p)}var v;v=[].concat(h,c);for(var g=0;g<s;g++){var b=v[g];b.getCoordinate().y=g,this.board.board[g][f]=b,b.setCoordinate(f,g)}}},o}(r));o._RF.pop()}}}));

System.register("bundle://main/_virtual/main",["./AssetLoader.ts","./GameManager.ts","./MileStone.ts","./Tile.ts","./TileGrid.ts","./TilePool.ts","./GameConfig.ts","./Type.ts","./Match3Board.ts","./UIManager.ts","./BoardState.ts","./FallState.ts","./IdleState.ts","./KillState.ts","./PauseState.ts","./ShuffleState.ts","./ColumnSubTile.ts","./Diamond.ts","./Explosion.ts","./RainBowSubTile.ts","./RowSubTile.ts","./SubTile.ts","./Board.ts","./DiamondTile.ts","./Turn.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("bundle://main/_virtual/Match3Board.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./FallState.ts","./IdleState.ts","./KillState.ts","./PauseState.ts","./ShuffleState.ts","./Diamond.ts"],(function(t){var e,i,r,n,o,a,u,s,c,l,h,d,f,g,p,b,y,v,S,m,T;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){o=t.cclegacy,a=t._decorator,u=t.Node,s=t.Sprite,c=t.Prefab,l=t.ParticleSystem2D,h=t.AudioSource,d=t.instantiate,f=t.Vec3,g=t.Component},function(t){p=t.default},function(t){b=t.default},function(t){y=t.default},function(t){v=t.default},function(t){S=t.default},function(t){m=t.default},function(t){T=t.default}],execute:function(){var w,C,P,G,H,x,z,B,M,N,k,W,D,F,E,O,I,L,_,V,X,j;o._RF.push({},"a44ef9g375BYLJdO8wLjQ1B","Match3Board",void 0);var A=a.ccclass,R=a.property;t("default",(w=A("Match3Board"),C=R(u),P=R(u),G=R(s),H=R(c),x=R(c),z=R(u),B=R(l),M=R(h),N=R(h),w(((j=function(t){i(o,t);var e=o.prototype;function o(){var e;return(e=t.call(this)||this).isOver=!1,r(e,"starPos",D,n(e)),r(e,"boardNode",F,n(e)),r(e,"cursor",E,n(e)),r(e,"diamondPrefab",O,n(e)),r(e,"brickPrefab",I,n(e)),r(e,"bgNode",L,n(e)),e.pausing=!1,e.mileStone=500,e.turn=5,r(e,"confetti",_,n(e)),r(e,"sfx",V,n(e)),r(e,"diaSFX",X,n(e)),e.highscore=0,e.state={},e.currentState=null,e.board=[],e.state={idle:new y(n(e)),kill:new v(n(e)),fall:new b(n(e)),shuffle:new m(n(e)),pause:new S(n(e))},e}return e.launchConfetti=function(){this.confetti.forEach((function(t){t.resetSystem()}))},e.isGameOver=function(){return this.turn<=0},e.getHighscore=function(){this.highscore=Number(localStorage.getItem("highscore"))||0},e.setHighscore=function(){o.score>this.highscore&&(this.highscore=o.score,localStorage.setItem("highscore",String(o.score)))},e.getCurrentState=function(){return this.currentState},e.pause=function(){this.switchState("pause"),this.pausing=!0},e.unpause=function(){this.pausing&&(this.pausing=!1,this.switchState("fall"))},e.disableBG=function(){this.bgNode.active=!1},e.enableBG=function(){this.bgNode.active=!0},e.update=function(t){var e;null==(e=this.currentState)||e.onUpdate()},e.start=function(){var t,e;o.SoundOn?null==(e=this.sfx)||e.play():null==(t=this.sfx)||t.pause(),o.score=0,this.createBoard(),this.switchState("shuffle"),this.getHighscore()},e.switchState=function(t,e,i){var r;this.pausing||(console.log("switch tp: ",t),null==(r=this.currentState)||r.onExit(),this.currentState=this.state[t],this.currentState.onEnter(e,i))},e.createBoard=function(){var t;null==(t=this.node)||t.addChild(this.cursor.node);for(var e=0;e<p.GridHeight;e++){this.board[e]=[];for(var i=0;i<p.GridWidth;i++)this.createBorder(i,e)}for(e=0;e<p.GridHeight;e++){this.board[e]=[];for(i=0;i<p.GridWidth;i++)this.board[e].push(this.addDiamond(i,e))}},e.canPause=function(){return!(this.currentState instanceof m&&!this.pausing)},e.createBorder=function(t,e){var i=d(this.brickPrefab);this.bgNode.addChild(i),null==i||i.setPosition(new f(o.coordToPos(t,e).x,o.coordToPos(t,e).y,-1))},e.addDiamond=function(t,e){var i,r=d(this.diamondPrefab),n=null==r?void 0:r.getComponent(T);return null==(i=this.boardNode)||i.addChild(r),n.randomType(),null==n||n.setCoordinate(t,e),n.lastcoordinate={x:t,y:e},null==n||n.createFX(this),n},o.coordToPos=function(t,e){return{x:-p.GridWidth*p.TileWidth/2+p.TileWidth/2+t*p.TileWidth,y:-(-p.GridHeight*p.TileHeight/2+p.TileHeight/2+e*p.TileHeight)}},e.getProgress=function(){return o.score/this.mileStone>1?1:o.score/this.mileStone},o.increase=function(){o.score+=10},e.getVerticleMatch=function(t,e){void 0===e&&(e=t.getType());var i=[];i.push(t);for(var r=1;r<p.GridHeight;r++)if(t.getCoordinate().y+r<p.GridHeight){var n=this.board[t.getCoordinate().y+r][t.getCoordinate().x];if(n&&n.getType()!=t.getType())break;n&&n.getType()===t.getType()&&i.push(n)}for(var o=1;o<p.GridHeight;o++)if(t.getCoordinate().y-o>=0){var a=this.board[t.getCoordinate().y-o][t.getCoordinate().x];if(a&&a.getType()!=t.getType())break;a&&a.getType()===t.getType()&&i.push(a)}return i.length>=3?i:[]},e.getHorizontalMatch=function(t,e){void 0===e&&(e=t.getType());var i=[];i.push(t);for(var r=1;r<p.GridWidth;r++)if(t.getCoordinate().x+r<p.GridHeight){var n=this.board[t.getCoordinate().y][t.getCoordinate().x+r];if(n&&n.getType()!=t.getType())break;n&&n.getType()===t.getType()&&i.push(n)}for(var o=1;o<p.GridWidth;o++)if(t.getCoordinate().x-o>=0){var a=this.board[t.getCoordinate().y][t.getCoordinate().x-o];if(a&&a.getType()!=t.getType())break;a&&a.getType()===t.getType()&&i.push(a)}return i.length>=3?i:[]},e.getMatch=function(t){var e=this.getVerticleMatch(t),i=this.getHorizontalMatch(t),r=[];if(e.length>0)for(var n=1;n<i.length;n++)r.push(i[n]);else r=i;return[].concat(e,r)},e.checkAll=function(t){var e=this;void 0===t&&(t=this.board);var i=[];return t.forEach((function(t){t.forEach((function(t){i=[].concat(e.getMatch(t),i)}))})),i},o}(g)).score=0,j.SoundOn=!0,D=e((W=j).prototype,"starPos",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),F=e(W.prototype,"boardNode",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(W.prototype,"cursor",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(W.prototype,"diamondPrefab",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(W.prototype,"brickPrefab",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(W.prototype,"bgNode",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(W.prototype,"confetti",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),V=e(W.prototype,"sfx",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(W.prototype,"diaSFX",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=W))||k));o._RF.pop()}}}));

System.register("bundle://main/_virtual/MileStone.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TilePool.ts"],(function(e){var t,r,n,o,i,l,a,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){i=e.cclegacy,l=e._decorator,a=e.Component},function(e){c=e.default}],execute:function(){var u,s,p,f,d;i._RF.push({},"3ed76mQYYVAVrQQO6HuEBf3","MileStone",void 0);var y=l.ccclass,h=l.property;e("default",(u=y("MileStone"),s=h(c),u((d=t((f=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return t=e.call.apply(e,[this].concat(i))||this,n(t,"pool",d,o(t)),t.form=[],t}return r(t,e),t}(a)).prototype,"pool",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=f))||p));i._RF.pop()}}}));

System.register("bundle://main/_virtual/PauseState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BoardState.ts"],(function(t){var n,e,o;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy},function(t){o=t.default}],execute:function(){e._RF.push({},"428b8ClZ9pKFKxGWPcfAZT1","PauseState",void 0);t("default",function(t){function e(){for(var n,e=arguments.length,o=new Array(e),r=0;r<e;r++)o[r]=arguments[r];return(n=t.call.apply(t,[this].concat(o))||this).promises=[],n}n(e,t);var o=e.prototype;return o.onEnter=function(){},o.onExit=function(){},o.onUpdate=function(){},e}(o));e._RF.pop()}}}));

System.register("bundle://main/_virtual/RainBowSubTile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SubTile.ts"],(function(e){var n,t,o,i,r,u,a;return{setters:[function(e){n=e.inheritsLoose,t=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,i=e._decorator,r=e.tween,u=e.Vec3},function(e){a=e.SubTile}],execute:function(){var c;o._RF.push({},"c231fmSVBBOWLRGlIRs1oZn","RainBowSubTile",void 0);var l=i.ccclass;i.property,e("RainBowSubTile",l("RainBowSubTile")(c=function(e){function o(){return e.apply(this,arguments)||this}n(o,e);var i=o.prototype;return i.getRelative=function(e){for(var n,o=this,i=[],r=t(e.board);!(n=r()).done;)for(var u,a=n.value,c=t(a);!(u=c()).done;){var l=u.value;l.getType()==this.diamond.getType()&&i.push(l)}return i.filter((function(e){return!e.pending})).filter((function(e){return e!=o.diamond}))},i.launch=function(e){var n=this;if(!this.diamond.node.active)return[];for(var o,i=[],a=function(){var e=o.value;i.push(new Promise((function(t){r(e.node).to(.1,{scale:new u(2,2)}).to(.3,{position:n.diamond.node.position}).call((function(){return t()})).start()})))},c=t(this.getRelative(e));!(o=c()).done;)a();return i},o}(a))||c);o._RF.pop()}}}));

System.register("bundle://main/_virtual/rollupPluginModLoBabelHelpers.js",[],(function(t){return{execute:function(){function r(t,r,e,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void e(t)}c.done?r(u):Promise.resolve(u).then(n,o)}function e(){return(e=t("extends",Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t})).apply(this,arguments)}function n(r,e){return(n=t("setPrototypeOf",Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t}))(r,e)}function o(t,r){if(t){if("string"==typeof t)return i(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?i(t,r):void 0}}function i(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}t({applyDecoratedDescriptor:function(t,r,e,n,o){var i={};Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0);i=e.slice().reverse().reduce((function(e,n){return n(t,r,e)||e}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0);void 0===i.initializer&&(Object.defineProperty(t,r,i),i=null);return i},arrayLikeToArray:i,assertThisInitialized:function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},asyncToGenerator:function(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function c(t){r(a,o,i,c,u,"next",t)}function u(t){r(a,o,i,c,u,"throw",t)}c(void 0)}))}},createForOfIteratorHelperLoose:function(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=o(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},extends:e,inheritsLoose:function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,n(t,r)},initializerDefineProperty:function(t,r,e,n){if(!e)return;Object.defineProperty(t,r,{enumerable:e.enumerable,configurable:e.configurable,writable:e.writable,value:e.initializer?e.initializer.call(n):void 0})},regeneratorRuntime:function(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t("regeneratorRuntime",(function(){return e}));var r,e={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,r,e){t[r]=e.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function f(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{f({},"")}catch(r){f=function(t,r,e){return t[r]=e}}function s(t,r,e,n){var o=r&&r.prototype instanceof g?r:g,a=Object.create(o.prototype),c=new k(n||[]);return i(a,"_invoke",{value:_(t,e,c)}),a}function h(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var p="suspendedStart",y="executing",v="completed",d={};function g(){}function m(){}function b(){}var w={};f(w,c,(function(){return this}));var L=Object.getPrototypeOf,O=L&&L(L(z([])));O&&O!==n&&o.call(O,c)&&(w=O);var x=b.prototype=g.prototype=Object.create(w);function j(t){["next","throw","return"].forEach((function(r){f(t,r,(function(t){return this._invoke(r,t)}))}))}function E(t,r){function e(n,i,a,c){var u=h(t[n],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&o.call(f,"__await")?r.resolve(f.__await).then((function(t){e("next",t,a,c)}),(function(t){e("throw",t,a,c)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return e("throw",t,a,c)}))}c(u.arg)}var n;i(this,"_invoke",{value:function(t,o){function i(){return new r((function(r,n){e(t,o,r,n)}))}return n=n?n.then(i,i):i()}})}function _(t,e,n){var o=p;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:r,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===d)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=h(t,e,n);if("normal"===l.type){if(o=n.done?v:"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function P(t,e){var n=e.method,o=t.iterator[n];if(o===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=r,P(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=h(o,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function S(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function T(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function z(t){if(t||""===t){var e=t[c];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=b,i(x,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:m,configurable:!0}),m.displayName=f(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===m||"GeneratorFunction"===(r.displayName||r.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,f(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},j(E.prototype),f(E.prototype,u,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},j(x),f(x,l,"Generator"),f(x,c,(function(){return this})),f(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var r=Object(t),e=[];for(var n in r)e.push(n);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=z,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return c.type="throw",c.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),l=o.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),d},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),T(e),d}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;T(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:z(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),d}},e},setPrototypeOf:n,unsupportedIterableToArray:o})}}}));

System.register("bundle://main/_virtual/RowSubTile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SubTile.ts"],(function(o){var n,i,t,e,d,s;return{setters:[function(o){n=o.inheritsLoose},function(o){i=o.cclegacy,t=o._decorator,e=o.Vec3,d=o.tween},function(o){s=o.SubTile}],execute:function(){var r;i._RF.push({},"a47b5YLW6ZHM7EhYnpTVpLW","RowSubTile",void 0);var a=t.ccclass;t.property,o("RowSubTile",a("RowSubTile")(r=function(o){function i(){return o.apply(this,arguments)||this}n(i,o);var t=i.prototype;return t.getRelative=function(o){var n=this;return o.board[this.diamond.getCoordinate().y].filter((function(o){return!o.pending})).filter((function(o){return o!=n.diamond}))},t.launch=function(o){var n=this;if(!this.diamond.node.active)return[];var i=this.diamond.rowFX[0],t=this.diamond.rowFX[1];console.log(t),i.node.active=!0,t.node.active=!0,i.node.setPosition(this.diamond.node.position),t.node.setPosition(this.diamond.node.position),i.node.setRotationFromEuler(0,0,0),t.node.setRotationFromEuler(0,0,180);var s=new e(this.diamond.node.position.x-1e3,this.diamond.node.position.y),r=new e(this.diamond.node.position.x+1e3,this.diamond.node.position.y);return console.log(r),d(i.node).to(.35,{position:new e(s.x,s.y)}).call((function(){i.node.active=!1,i.node.setPosition(n.diamond.node.position)})).start(),d(t.node).to(.35,{position:new e(r.x,r.y)}).call((function(){console.log("done"),t.node.active=!1,t.node.setPosition(n.diamond.node.position)})).start(),[]},i}(s))||r);i._RF.pop()}}}));

System.register("bundle://main/_virtual/ShuffleState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./Match3Board.ts","./BoardState.ts"],(function(o){var r,t,a,e,n,i,s,h;return{setters:[function(o){r=o.inheritsLoose,t=o.createForOfIteratorHelperLoose},function(o){a=o.cclegacy,e=o.tween,n=o.Vec3},function(o){i=o.default},function(o){s=o.default},function(o){h=o.default}],execute:function(){a._RF.push({},"377ecZeFh9L8pt7Z1H6qzCI","ShuffleState",void 0);o("default",function(o){function a(){for(var r,t=arguments.length,a=new Array(t),e=0;e<t;e++)a[e]=arguments[e];return(r=o.call.apply(o,[this].concat(a))||this).rotateTwin=null,r.promises=[],r.movepromises=[],r.run=[r.moveAroundCircle,r.moveAroundStar],r}r(a,o);var h=a.prototype;return h.onEnter=function(){var o=this;this.promises=[],this.movepromises=[],this.run[Math.floor(Math.random()*this.run.length)].call(this),this.rotate(),this.shuffle(),Promise.all(this.promises).then((function(){Promise.all(o.movepromises).then((function(){o.board.switchState("fall")}))}))},h.moveBack=function(){for(var o=0;o<i.GridHeight;o++)for(var r=0;r<i.GridWidth;r++){var t=s.coordToPos(this.board.board[o][r].getCoordinate().x,this.board.board[o][r].getCoordinate().y);this.movepromises.push(this.board.board[o][r].move(t.x,t.y,1,"backOut"))}},h.calcStarPos=function(){for(var o,r=[],a=t(this.board.board);!(o=a()).done;){var e=o.value;r.push.apply(r,e)}for(var n=r.length,i=[],s=0;s<10;s++){var h=2*Math.PI*s/10-Math.PI/2,u=s%2==0?250:100,d=0+u*Math.cos(h),l=0+u*Math.sin(h);i.push({x:d,y:l})}for(var c=Math.floor(n/10),f=[],v=0,p=0;p<10;p++)for(var b=i[p],m=i[(p+1)%10],y=0;y<c&&v<n;y++){var g=y/c,x=b.x*(1-g)+m.x*g,M=b.y*(1-g)+m.y*g,P=Math.floor(v/this.board.board[0].length),S=v%this.board.board[0].length;f[P]||(f[P]=[]),f[P][S]={x:x,y:M},v++}return f},h.rotate=function(){var o=this;this.rotateTwin||this.promises.push(new Promise((function(r){e(o.board.boardNode).repeat(1,e().to(3,{eulerAngles:new n(0,0,360)}).call((function(){o.board.boardNode.eulerAngles=new n(0,0,0)}))).call((function(){o.moveBack(),o.board.boardNode.eulerAngles=new n(0,0,0),r()})).start()})))},h.onExit=function(){},h.onUpdate=function(){},h.shuffle=function(){for(var o=this.board.board.length,r=this.board.board[0].length,t=[],a=0;a<o;a++)for(var e=0;e<r;e++){var n=this.board.board[a][e];n&&t.push(n)}for(var i=t.length-1;i>0;i--){var h=Math.floor(Math.random()*(i+1)),u=t[i];t[i]=t[h],t[h]=u}for(var d=0,l=0;l<o;l++)for(var c=0;c<r;c++){var f=t[d];f.setCoordinate(c,l);var v=s.coordToPos(c,l);f.node.setPosition(v.x,v.y),this.board.board[l][c]=f,d++}},h.moveAroundCircle=function(){for(var o,r=this,a=new Set,e=[],n=this.calculateCircularPos(this.board.board,200),s=t(n);!(o=s()).done;){var h=o.value;e.push.apply(e,h)}for(var u=0;u<i.GridHeight;u++)for(var d,l=function(){d={x:0,y:0};var o=r.board.board[u][c],t=-1;e.forEach((function(e){var n=r.calcDistance(e,{x:o.node.position.x,y:o.node.position.y});(n<t||-1==t)&&!a.has(e)&&(d=e,t=n)})),a.add(d),r.promises.push(r.board.board[u][c].move(d.x,d.y,1,"sineOut"))},c=0;c<i.GridWidth;c++)l()},h.calcDistance=function(o,r){var t=r.x-o.x,a=r.y-o.y;return t*t+a*a},h.moveAroundStar=function(){for(var o=this.calcStarPos(),r=0;r<i.GridHeight;r++)for(var t=0;t<i.GridWidth;t++)o[r][t]?this.promises.push(this.board.board[r][t].move(o[r][t].x,o[r][t].y,1,"sineOut")):this.promises.push(this.board.board[r][t].move(o[0][0].x,o[0][0].y,1,"sineOut"))},h.calculateCircularPos=function(o,r){for(var t,a=o.length,e=(null==(t=o[0])?void 0:t.length)||0,n=[],i=a*e,s=0;s<a;s++){for(var h=[],u=0;u<e;u++){var d=s*e+u,l=2*Math.PI*d/i,c=0+r*Math.cos(l),f=0+r*Math.sin(l);h.push({x:c,y:f})}n.push(h)}return n},a}(h));a._RF.pop()}}}));

System.register("bundle://main/_virtual/SubTile.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,i,o;return{setters:[function(e){n=e.inheritsLoose},function(e){t=e.cclegacy,i=e._decorator,o=e.Component}],execute:function(){var r;t._RF.push({},"4468010PS1GzaCorywathAP","SubTile",void 0);var u=i.ccclass;i.property,e("SubTile",u("SubTile")(r=function(e){function t(n){var t;return(t=e.call(this)||this).diamond=void 0,t.diamond=n,t}return n(t,e),t}(o))||r);t._RF.pop()}}}));

System.register("bundle://main/_virtual/Tile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts"],(function(e){var t,i,n,o,r,s,l,a,c,u,h,p,f,d,g,v,w,T;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,r=e.createForOfIteratorHelperLoose,s=e.asyncToGenerator,l=e.regeneratorRuntime},function(e){a=e.cclegacy,c=e._decorator,u=e.Sprite,h=e.Color,p=e.tween,f=e.Vec3,d=e.Button,g=e.resources,v=e.SpriteFrame,w=e.Component},function(e){T=e.default}],execute:function(){var y,b,k,m,C,x,D;a._RF.push({},"df56acXknlGaYhEaXrwyRVa","Tile",void 0);var P=c.ccclass,O=c.property;e("Tile",(y=P("Tile"),b=O(u),k=O(u),y((x=t((C=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return t=e.call.apply(e,[this].concat(r))||this,n(t,"light",x,o(t)),n(t,"sprite",D,o(t)),t.used=!1,t.coords={x:0,y:0},t.tileType=T.CandyTypes[0],t.callbacks=[],t.flipTween=null,t.effect="tile",t.onDeadCallback=[],t}i(t,e);var a=t.prototype;return a.__preload=function(){if(!this.sprite)throw new Error("Sprite is required")},a.addOnClickCallback=function(e){this.callbacks.push(e)},a.addOnDead=function(e){this.onDeadCallback.push(e)},a.removeOnClickCallback=function(e){this.callbacks=e?this.callbacks.filter((function(t){return t!==e})):[]},a.getonDeadCallBack=function(){return this.onDeadCallback},a.update=function(e){var t,i,n;this.light&&(this.light.color=new h(null==(t=this.sprite)?void 0:t.color.r,null==(i=this.sprite)?void 0:i.color.g,null==(n=this.sprite)?void 0:n.color.b,10))},a.emitOnDead=function(){var e=s(l().mark((function e(){var t,i,n,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[],i=r(this.onDeadCallback);!(n=i()).done;)o=n.value,t.push(o(this));return this.onDeadCallback=[],e.next=5,Promise.all(t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.emitOnClick=function(){console.log(this.coords);for(var e,t=r(this.callbacks);!(e=t()).done;){(0,e.value)(this)}},a.getTileType=function(){return this.tileType},a.chose=function(){var e,t=this;this.flipTween?this.flipTween.start():this.flipTween=p(null==(e=this.sprite)?void 0:e.node).to(.2,{scale:new f(1.25,1.25)}).repeatForever(p().to(.25,{eulerAngles:new f(0,0,20)}).to(.5,{eulerAngles:new f(0,0,-20)}).to(.25,{eulerAngles:new f(0,0,0)}).call((function(){console.log(t.node.getComponent(d))}))).start()},a.setTileType=function(e){this.tileType=e,this.sprite&&(this.sprite.color=T.CandyColor[e])},a.onDestroy=function(){this.callbacks=[]},a.release=function(){var e,t;null==(e=this.flipTween)||e.stop(),p(null==(t=this.sprite)?void 0:t.node).to(.2,{scale:new f(1,1,1)}).to(.1,{eulerAngles:new f(0,0,0)},{easing:"bounceOut"}).start()},a.moveTo=function(){var e=s(l().mark((function e(t,i,n,o,r,s,a){var c=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=1),void 0===o&&(o=.3),void 0===r&&(r="linear"),void 0===s&&(s=!1),this.coords.x=t,this.coords.y=i,e.abrupt("return",new Promise((function(e){p(c.node).to(.15,{scale:new f(n,n,1)},{easing:r}).to(.15,{scale:new f(1,1,1)}).call((function(){s&&p(c.node).to((o-.4)/2,{scale:new f(1.25,1.25,1)},{easing:"bounceOut"}).to((o-.4)/2,{scale:new f(1,1,1)}).start()})).start(),p(c.node).to(o,{position:new f(c.getTilePosition().x,c.getTilePosition().y,0)},{easing:r}).call((function(){e()})).start()})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,i,n,o,r,s,l){return e.apply(this,arguments)}}(),a.setEffect=function(e){if(this.effect=e,"pend"!=e){var t=g.get("images/"+e+"/spriteFrame",v);this.sprite.spriteFrame=t}},a.Bounce=function(e){var t=e.getTilePosition();p(this.node).to(.2,{position:new f(t.x,t.y,0)}).to(.2,{position:new f(this.getTilePosition().x,this.getTilePosition().y,0)}).start()},a.resetPosToCoord=function(){this.node.setPosition(this.coords.x,this.coords.y,0)},a.getTilePosition=function(){return{x:-T.GridWidth*T.TileWidth/2+T.TileWidth/2+this.coords.x*T.TileWidth,y:-(-T.GridHeight*T.TileHeight/2+T.TileHeight/2+this.coords.y*T.TileHeight)}},a.rotateWhole=function(e){var t=this;p(this.node).to(e,{eulerAngles:new f(0,0,90)}).call((function(){t.node.eulerAngles=new f})).start()},t}(w)).prototype,"light",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(C.prototype,"sprite",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=C))||m));a._RF.pop()}}}));

System.register("bundle://main/_virtual/TileGrid.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./GameManager.ts"],(function(e){var t,n,r,i,o,s,a,c,l,u,h,f;return{setters:[function(e){t=e.inheritsLoose,n=e.asyncToGenerator,r=e.regeneratorRuntime,i=e.createForOfIteratorHelperLoose,o=e.extends},function(e){s=e.cclegacy,a=e._decorator,c=e.Component,l=e.tween,u=e.Vec3},function(e){h=e.default},function(e){f=e.default}],execute:function(){var d;s._RF.push({},"047c14s9cxD4IZqztDgvRx2","TileGrid",void 0);var p=a.ccclass;a.property,e("default",p("TileGrid")(d=function(e){function s(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).tileTable=[],t.choosingTile=null,t.canChoose=!0,t.pool=null,t.progress=0,t.shuffling=!1,t}t(s,e);var a=s.prototype;return a.initTable=function(){this.tileTable=[]},a.idleRun=function(){var e;null==(e=this.pool)||e.getList().forEach((function(e){e.rotateWhole(Math.abs(.8-(e.coords.x+e.coords.y)/20))}))},a.fillTable=function(){var e=n(r().mark((function e(t){var n,i,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.pool=t,n=[],i=0;i<h.GridHeight;i++)for(this.tileTable[i]=[],o=0;o<h.GridWidth;o++)(s=t.getFirst()).coords={x:o,y:i},this.tileTable[i][o]=s,n.push(s.moveTo(o,i,.25,1,"bounceOut"));return e.next=5,Promise.all(n);case 5:return e.next=7,this.killAllSame();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.killAllSame=function(){var e=n(r().mark((function e(){var t,n,o,s,a,c,l,u,h,f,d,p,g,x,v,T,y,b,k,w,m,M,G,P,E,H,C,O,A,S,D=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shuffling){e.next=2;break}return e.abrupt("return");case 2:console.log("kill"),t=[],n=new Set,o=i(this.tileTable);case 6:if((s=o()).done){e.next=20;break}a=s.value,c=i(a);case 9:if((l=c()).done){e.next=18;break}if((u=l.value).used){e.next=13;break}return e.abrupt("continue",16);case 13:if(h=u.getTilePosition(),f=h.x+","+h.y,!n.has(f)&&(d=this.getMatch(u)).length>0)for(t.push(d),p=i(d);!(g=p()).done;)x=g.value,v=x.getTilePosition(),n.add(v.x+","+v.y);case 16:e.next=9;break;case 18:e.next=6;break;case 20:for(t.sort((function(e,t){return t.length-e.length})),T=new Set,y=[],b=0,k=t;b<k.length;b++){for(w=k[b],m=!1,M=[],G=i(w);!(P=G()).done;)E=P.value,H=E.getTilePosition(),C=H.x+","+H.y,M.push(C),T.has(C)||(m=!0);if(m){for(O=i(M);!(A=O()).done;)S=A.value,T.add(S);y.push(this.killMultipleGrid(w,!0,w.length>3))}}return console.log(y),e.next=27,Promise.all(y).then((function(){return D.moveUnusedTilesUp()}));case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.setUpManager=function(e){this.tileTable.forEach((function(t){t.forEach((function(t){t.addOnClickCallback((function(t){console.log("Tile clicked:",t.coords),e.Chose(t)}))}))}))},a.moveUnusedTilesUp=function(){var e=n(r().mark((function e(){var t,n,i,o,s,a,c,l,u,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(console.log("move"),t=this.tileTable.length,n=this.tileTable[0].length,i=0;i<n;i++){for(o=[],s=[],a=0;a<t;a++)(c=this.tileTable[a][i]).used?o.push(c):(s.push(c),c.node.setPosition(c.getTilePosition().x,500));for([],l=[].concat(s,o),u=0;u<t;u++)(h=l[u]).coords.y,h.coords.y=u,this.tileTable[u][i]=h}return e.next=6,this.showTile();case 6:console.log("move call show");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.showTile=function(){var e=n(r().mark((function e(t){var n,i,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("tile"),this.canChoose=!0,n=[],i=0,this.tileTable.forEach((function(e){e.forEach((function(e){if(e.used){var t=e.node.position.y!==e.getTilePosition().y;n.push(e.moveTo(e.coords.x,e.coords.y,1,.8,"bounceOut",t))}else{e.used=!0,e.node.active=!0;var r=h.CandyTypes[Math.floor(Math.random()*h.CandyTypes.length)];e.setTileType(r),n.push(e.moveTo(e.coords.x,e.coords.y,.5,.8,"bounceOut",!0)),i++}}))})),console.log("Total tiles spawned:",i),e.next=9,Promise.all(n);case 9:if(!((o=this.checkAll()).length>0)){e.next=17;break}if(!(o.length>0)){e.next=15;break}return e.next=14,this.killAllSame();case 14:console.log("showtile call kill");case 15:e.next=18;break;case 17:this.canChoose=!0;case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.getTileAt=function(e,t){return e<0||e>=h.GridWidth||t<0||t>=h.GridHeight?null:this.tileTable[t][e]||null},a.shuffle=function(){var e=n(r().mark((function e(){var t,o,s,a,c=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.shuffling=!0,t=[],this.pool){e.next=4;break}return e.abrupt("return");case 4:o=r().mark((function e(){var i,o,s,f;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=a.value,o=Math.floor(Math.random()*h.GridWidth),s=Math.floor(Math.random()*h.GridHeight),f=c.tileTable[s][o],t.push(new Promise((function(e){l(i.node).to(.5,{scale:new u(.8,.8)}).to(2,{position:new u(0,0,1)},{easing:"bounceOut"}).call(n(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c.swap(i,f,!1,!0),e();case 2:case"end":return t.stop()}}),t)})))).start()})));case 5:case"end":return e.stop()}}),e)})),s=i(this.pool.getList());case 6:if((a=s()).done){e.next=10;break}return e.delegateYield(o(),"t0",8);case 8:e.next=6;break;case 10:return e.next=12,Promise.all(t);case 12:return this.shuffling=!1,e.next=15,this.killAllSame();case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.getVerticleMatch=function(e){var t=[];t.push(e);for(var n=1;n<h.GridHeight;n++)if(e.coords.y+n<h.GridHeight){var r=this.tileTable[e.coords.y+n][e.coords.x];if(r&&r.getTileType()!=e.getTileType())break;r&&r.getTileType()===e.getTileType()&&t.push(r)}for(var i=1;i<h.GridHeight;i++)if(e.coords.y-i>=0){var o=this.tileTable[e.coords.y-i][e.coords.x];if(o&&o.getTileType()!=e.getTileType())break;o&&o.getTileType()===e.getTileType()&&t.push(o)}return t.length>=3?t:[]},a.killPend=function(){var e=n(r().mark((function e(t,n){var i,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=!0),i=[],!(t&&t.length>0)){e.next=7;break}return o=new u(t[0].getTilePosition().x,t[0].getTilePosition().y,0),n&&t&&t.forEach((function(e){var t=new Promise((function(t){l(e.node).to(.2,{position:o}).call((function(){return t()})).start()}));i.push(t)})),e.next=7,Promise.all(i);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.checkAll=function(e){var t=this;void 0===e&&(e=this.tileTable);var n=[];return e.forEach((function(e){e.forEach((function(e){n=[].concat(t.getMatch(e),n)}))})),n},a.getHorizontalMatch=function(e){var t=[];t.push(e);for(var n=1;n<h.GridWidth;n++)if(e.coords.x+n<h.GridWidth){var r=this.tileTable[e.coords.y][e.coords.x+n];if(r&&r.getTileType()!=e.getTileType())break;r&&r.getTileType()===e.getTileType()&&t.push(r)}for(var i=1;i<h.GridHeight;i++)if(e.coords.x-i>=0){var o=this.tileTable[e.coords.y][e.coords.x-i];if(o&&o.getTileType()!=e.getTileType())break;o&&o.getTileType()===e.getTileType()&&t.push(o)}return t.length>=3?t:[]},a.getMatch=function(e){var t=this.getVerticleMatch(e),n=this.getHorizontalMatch(e),r=[];if(t.length>0&&t.length>0)for(var i=1;i<n.length;i++)r.push(n[i]);else r=n;return[].concat(t,r)},a.getAllVerticle=function(){return[]},a.getAllHorizontal=function(){return[]},a.killGrid=function(){var e=n(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("tile"!=t.effect||!t.used){e.next=5;break}return e.next=3,t.emitOnDead();case 3:null==(n=this.pool)||n.returnPool(t),f.increase();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.killMultipleGrid=function(){var e=n(r().mark((function e(t,o,s){var a,c,h,f,d,p,g,x,v,T=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(void 0===o&&(o=!1),void 0===s&&(s=!1),t=t.filter((function(e){return e.used}))||[],a=[],c=i(t);!(h=c()).done;)"tile"!==(f=h.value).effect&&(f.setEffect("tile"),a.push(this.killGrid(f)));return t.length>=5&&o&&(d=this.getHorizontalMatch(t[0]).length>=5,p=this.getVerticleMatch(t[0]).length>=5,d||p?(t[0].setEffect("rainbow"),this.addEffect(t[0],"rainbow")):(t[0].setEffect("explosion"),this.addEffect(t[0],"explosion"))),4===t.length&&o&&(this.getHorizontalMatch(t[0]).length>0?(t[0].setEffect("column"),this.addEffect(t[0],"column")):(t[0].setEffect("row"),this.addEffect(t[0],"row"))),t=t.filter((function(e){return e.used}))||[],e.next=10,this.killPend(t,s);case 10:g=r().mark((function e(){var t,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=v.value,i=new Promise((function(e){l(t.node).to(.2,{scale:new u(0,0,0)}).call(n(r().mark((function n(){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.used){n.next=3;break}return n.next=3,T.killGrid(t);case 3:e();case 4:case"end":return n.stop()}}),n)})))).start()})),a.push(i);case 3:case"end":return e.stop()}}),e)})),x=i(t);case 12:if((v=x()).done){e.next=16;break}return e.delegateYield(g(),"t0",14);case 14:e.next=12;break;case 16:return e.next=18,Promise.all(a);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),a.putGridAt=function(e,t){},a.getTilePos=function(e,t){return{x:0,y:0}},a.canMove=function(e,t){return e.coords&&t.coords&&1===Math.abs(e.coords.x-t.coords.x)&&e.coords.y===t.coords.y||1===Math.abs(e.coords.y-t.coords.y)&&e.coords.x===t.coords.x},a.canSwap=function(e,t){return this.canMove(e,t)},a.swap=function(){var e=n(r().mark((function e(t,n,i,s){var a,c,l,u,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===i&&(i=!1),void 0===s&&(s=!1),this.canChoose=!1,a=o({},t.coords),c=o({},n.coords),t.coords=c,n.coords=a,this.tileTable[a.y][a.x]=n,this.tileTable[c.y][c.x]=t,e.next=11,Promise.all([t.moveTo(c.x,c.y,.5),n.moveTo(a.x,a.y,.5)]);case 11:if(s){e.next=31;break}if(l=[].concat(this.getMatch(t)),u=[].concat(this.getMatch(n)),h=[].concat(l,u),console.log("Matched tiles:",h.length),0!==h.length||i){e.next=25;break}return t.coords=a,n.coords=c,this.tileTable[a.y][a.x]=t,this.tileTable[c.y][c.x]=n,e.next=23,Promise.all([t.moveTo(a.x,a.y),n.moveTo(c.x,c.y)]);case 23:e.next=31;break;case 25:if(!(h.length>0)){e.next=31;break}return e.next=29,Promise.all([this.killMultipleGrid(this.getMatch(t),!0,this.getMatch(t).length>3),this.killMultipleGrid(this.getMatch(n),!0,this.getMatch(n).length>3)]);case 29:return e.next=31,this.moveUnusedTilesUp();case 31:this.canChoose=!0;case 32:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),a.addEffect=function(e,t){var i=this;"row"==t&&e.addOnDead(n(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.killMultipleGrid([e].concat(i.tileTable[e.coords.y].filter((function(t){return t!=e}))),!1,!0);case 2:case"end":return t.stop()}}),t)})))),"column"==t&&e.addOnDead(n(r().mark((function t(){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=[],o=0;o<h.GridHeight;o++)n.push(i.tileTable[o][e.coords.x]);return t.next=4,i.killMultipleGrid([e].concat(n.filter((function(t){return t!=e}))),!1,!0);case 4:case"end":return t.stop()}}),t)})))),"explosion"==t&&e.addOnDead(n(r().mark((function t(){var n,o,s,a,c,l,u,f,d,p,g,x,v;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=[],o=e.coords,s=o.x,a=o.y,c=[[0,-1],[0,1],[-1,0],[1,0],[1,1],[-1,1],[-1,-1],[1,-1]],n.push(e),l=0,u=c;l<u.length;l++)d=(f=u[l])[0],p=f[1],x=a+p,(g=s+d)>=0&&g<h.GridWidth&&x>=0&&x<h.GridHeight&&(v=i.tileTable[x][g])&&-1===n.indexOf(v)&&n.push(v);return t.next=9,i.killMultipleGrid(n,!1,!0);case 9:case"end":return t.stop()}}),t)})))),"rainbow"==t&&e.addOnDead(n(r().mark((function t(){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=[],null==(n=i.pool)||n.getList().forEach((function(t){t.getTileType()==e.getTileType()&&o.push(t)})),t.next=4,i.killMultipleGrid([e].concat(o.filter((function(t){return t!=e}))),!1,!0);case 4:case"end":return t.stop()}}),t)}))))},s}(c))||d);s._RF.pop()}}}));

System.register("bundle://main/_virtual/TilePool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./Tile.ts"],(function(t){var e,n,i,r,o,s,a,l,u;return{setters:[function(t){e=t.inheritsLoose,n=t.asyncToGenerator,i=t.regeneratorRuntime},function(t){r=t.cclegacy,o=t._decorator,s=t.instantiate,a=t.Component},function(t){l=t.default},function(t){u=t.Tile}],execute:function(){var f;r._RF.push({},"73922aUykhIg7+DtigexiFC","TilePool",void 0);var c=o.ccclass;o.property,t("default",c("TilePool")(f=function(t){function r(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).tileList=[],e.tilePrefab=null,e}e(r,t);var o=r.prototype;return o.getFirst=function(){for(var t=0;t<this.tileList.length;t++){var e=this.tileList[t];if(!e.used)return e.used=!0,e.node.active=!0,e}var n=s(this.tilePrefab);if(null===n)throw new Error("Tile prefab is not set up");var i=n.getComponent(u);if(null===i)throw new Error("Tile component is not found on the prefab");var r=l.CandyTypes[Math.floor(Math.random()*l.CandyTypes.length)];return i.setTileType(r),this.tileList.push(i),i.used=!0,i},o.setupPrefab=function(t){this.tilePrefab=t},o.returnPool=function(){var t=n(i().mark((function t(e){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.node.active=!1,e.used=!1,e.setEffect("tile"),e.node.setPosition(e.node.position.x,1e3);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),o.initPool=function(t){for(var e=0;e<t;e++)if(this.tilePrefab){var n=l.CandyTypes[Math.floor(Math.random()*l.CandyTypes.length)],i=s(this.tilePrefab);if(null===i)throw new Error("Tile prefab is not set up");var r=i.getComponent(u);r.setTileType(n),this.tileList.push(r)}},o.returnMultiple=function(t){},o.getList=function(){return this.tileList},r}(a))||f);r._RF.pop()}}}));

System.register("bundle://main/_virtual/Turn.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var r,e,t,u;return{setters:[function(n){r=n.inheritsLoose},function(n){e=n.cclegacy,t=n._decorator,u=n.Component}],execute:function(){var c;e._RF.push({},"cacffvaYVRJcLusP2Ys5eri","Turn",void 0);var o=t.ccclass;t.property,n("Turn",o("Turn")(c=function(n){function e(){return n.apply(this,arguments)||this}return r(e,n),e}(u))||c);e._RF.pop()}}}));

System.register("bundle://main/_virtual/Type.ts",["cc"],(function(){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"611b1oAI91LtJhYM2TRqCgT","Type",void 0),e._RF.pop()}}}));

System.register("bundle://main/_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Match3Board.ts","./IdleState.ts"],(function(e){var t,n,r,i,o,a,u,l,s,c,p,g,f,b,d,h,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,u=e.Button,l=e.Node,s=e.Label,c=e.ProgressBar,p=e.RichText,g=e.tween,f=e.Vec3,b=e.director,d=e.Component},function(e){h=e.default},function(e){m=e.default}],execute:function(){var v,S,w,P,T,y,x,B,O,z,U,I,G,M,D,H,R,_,C,F,L,j,q,A,E,K,N,V,Z;o._RF.push({},"fcfe9BKrgtD3prTZDF2nHqw","UIManager",void 0);var k=a.ccclass,J=a.property;e("UIManager",(v=k("UIManager"),S=J(h),w=J(u),P=J(l),T=J(u),y=J(u),x=J(u),B=J(s),O=J(l),z=J(c),U=J(p),I=J(p),G=J(p),M=J(p),v((R=t((H=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"board",R,i(t)),r(t,"newGameButton",_,i(t)),r(t,"pausePopUp",C,i(t)),r(t,"continueButton",F,i(t)),r(t,"pauseButton",L,i(t)),r(t,"soundButton",j,i(t)),r(t,"soundText",q,i(t)),r(t,"gameOverPopup",A,i(t)),r(t,"progressBar",E,i(t)),r(t,"scoreText",K,i(t)),r(t,"highScoreText",N,i(t)),t.idleState=null,r(t,"gameOverScoreText",V,i(t)),r(t,"remainTurnText",Z,i(t)),t}n(t,e);var o=t.prototype;return o.update=function(){var e,t,n,r;this.soundText.string="Turn Sound "+(h.SoundOn?"Off":"On"),null!=(e=this.board)&&e.isOver&&0==(null==(t=this.gameOverPopup)?void 0:t.active)&&this.gameOver(),!this.idleState&&(null==(n=this.board)?void 0:n.getCurrentState())instanceof m&&(this.idleState=this.board.getCurrentState()),this.remainTurnText.string="Remain Turn: "+String(null==(r=this.board)?void 0:r.turn),this.pauseButton.node.active=this.board.canPause(),this.progressBar.progress=this.board.getProgress(),this.scoreText.string="Score: "+String(h.score)},o.toggleSound=function(){var e,t;h.SoundOn=!h.SoundOn,h.SoundOn?null==(e=this.board)||null==(e=e.sfx)||e.play():null==(t=this.board)||null==(t=t.sfx)||t.pause()},o.pauseGame=function(){var e,t=this;if(null==(e=this.board)||!e.pausing){this.pausePopUp.active=!0;var n=[];n.push(new Promise((function(e){g(t.pausePopUp).to(.8,{position:new f},{easing:"bounceOut"}).call((function(){e()})).start()}))),Promise.all(n).then((function(){var e;null==(e=t.board)||e.pause(),t.pauseButton.node.active=!1}))}},o.gameOver=function(){var e,t=this;null==(e=this.board)||e.setHighscore(),this.highScoreText.string="Highscore: "+String(this.board.highscore),this.gameOverScoreText.string="Score: "+String(h.score),this.board.pausing=!0,this.gameOverPopup.active=!0;var n=[];n.push(new Promise((function(e){g(t.gameOverPopup).to(.8,{position:new f},{easing:"bounceOut"}).call((function(){e()})).start()}))),Promise.all(n).then((function(){var e;null==(e=t.board)||e.pause(),t.pauseButton.node.active=!1}))},o.unPauseGame=function(){var e=this,t=[];t.push(new Promise((function(t){g(e.pausePopUp).to(.5,{position:new f(0,900)},{easing:"sineIn"}).call((function(){t()})).start()}))),Promise.all(t).then((function(){var t;null==(t=e.board)||t.unpause(),e.pauseButton.node.active=!0,e.pausePopUp.active=!1}))},o.newGame=function(){var e;null==(e=this.idleState)||e.onExit(),b.loadScene("GameScene-refactor")},t}(d)).prototype,"board",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(H.prototype,"newGameButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(H.prototype,"pausePopUp",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(H.prototype,"continueButton",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(H.prototype,"pauseButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(H.prototype,"soundButton",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(H.prototype,"soundText",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(H.prototype,"gameOverPopup",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(H.prototype,"progressBar",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(H.prototype,"scoreText",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(H.prototype,"highScoreText",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(H.prototype,"gameOverScoreText",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(H.prototype,"remainTurnText",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=H))||D));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'bundle://main/_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});